# Homatask 3

## Task 1
   Создать группу **sales** с **gid=4000**:
   
   ```
   # groupadd -g 4000
   ```
   
   ![Результат вызова команды](/3/screenshots/task1_1.png)
   
   Создать пользователей **bob, alice, eve** с основной группой **sales**:
   
   ```
   # useradd -g sales bob
   # useradd -g sales alice
   # useradd -g sales eve
   ```
   
   ![Результат вызова команды](/3/screenshots/task1_2.png)
   
   Изменить пользователям пароли: 
   
   ```
   # passwd bob
   # passwd alice
   # passwd eve
   ```
   
   ![Результат вызова команды](/3/screenshots/task1_3.png)
   
   Файл **/etc/login.defs** содержит в себе настройки времени "жизни" паролей и аккаунтов, которые используются по умолчанию при создании 
   новых пользователей и групп в системе.
   
   Обновим */etc/login.defs** для того, чтобы теперь все новые аккаунты должны были менять (обновлять) свои пароли каждые **30 дней**, а именно изменим 
   значение переменной **PASS_MAX_DAYS** на равное 30.
   
   ```
   # vi /etc/login.defs
   ```
   
   ![Результат вызова команды](/3/screenshots/task1_4.png)
   
   Для того, чтобы убедиться, что внесенные изменияния действуют, создадим нового пользователя *Leo* и проверим информации о сроках действия его пароля:
   
   ![Результат вызова команды](/3/screenshots/task1_5.png)
   
   Изменить настройки пользователей из группы **sales (bob, alice, eve)** таким образом, чтобы срок действия их аккаунтов истек через **90 дней**:
   
   ```
   # chage -E $(date -d +90days +%Y-%m-%d) bob
   # chage -E 2021-04-23 alice
   # chage -E $(date -d +90days +%Y-%m-%d) eve   
   ```
   
   После флага **-E** необходимо указать точную дату истечения срока действия аккаунта пользователя в формате YYYY-MM-DD, либо восвпользоваться выводом утилиты ***date***.
   
   ![Результат вызова команды](/3/screenshots/task1_6.png)
   
   Установить для **bob** время смены пароля каждые **15 дней**:
   
   ```
   # chage -M 15 bob
   ```
   
   ![Результат вызова команды](/3/screenshots/task1_7.png)
   
   Для того, чтобы заставить пользователей сменить пароль после первого логина (т.е. в следующий раз, когда пользователь зайдет в систему), необходимо вызвать **chage** со следующими параметрами: 
   
   ```
   # chage -d 0 bob
   ```
   
   Флаг **-d** устанавливает дату последнего изменения пароля пользователя. Когда это значение равно нулю (или когда устанавленная дата + значение PASS_MAX_DAYS становится меньше, чем текущая дата), пользователь будет вынужден изменить пароль после первого входа в систему.
   
   ![Результат вызова команды](/3/screenshots/task1_8.png)
   
   При попытке входа в систему пользователь **bob** получает предупреждение и предложение о смене пароля:
   
   ![Результат вызова команды](/3/screenshots/task1_9.png)
   
  ***
   
     
   

## Task 2
   Создадим трёх новых пользователей **(glen, antony, lesly)** в группе **students**
   
   ```
   # groupadd students
   # useradd -g students glen
   # useradd -g students antony
   # useradd -g students lesly
   ```
   
   ![Результат вызова команды](/3/screenshots/task2_1.png)
   
   Создадим директорию **/home/students/**. 
   
   ```
   # mkdir /home/students
   ```
   
   ![Результат вызова команды](/3/screenshots/task2_2.png)
   
   Изменим группу её владельца на **students** и изменим ее параметры доступа таким образом, чтобы доступ к её содержимому, а также возможность создавать и удалять файлы имели только пользователи группы **students**:
   
   ```
   # cd /home
   # chown :students ./students && chmod g+w ./students && chmod o-rx ./students
   ```
   ![Результат вызова команды](/3/screenshots/task2_3.png)
   
   Теперь пользователи группы **students (lesly, antony, glen)** имеют совместный доступ к файлам директории **/home/students/**. Другие пользователи (конечно, кроме *root*) доступа к этой директории не имеют из-за установленных нами ранее прав доступа. На рисунке ниже это продемонстрировано:
   
   ![Результат вызова команды](/3/screenshots/task2_4.png)
   
   Для того, чтобы все файлы, созданные в директории **/home/students/**, автоматически присваивались группе **students**, нужно установить **sgid** на эту директорию:
   
   ```
   # chmod g+s /home/students
   ```
   
   ![Результат вызова команды](/3/screenshots/task2_5.png)
   
   Теперь даже файлы, созданные под пользователем *root*, принадлежат группе **students**.
   
   ![Результат вызова команды](/3/screenshots/task2_6.png)
   
  ***
 
 
   
## Task 3
   Создадим под пользователем *root* директорию **/share/cases/** и два файла в неё: **moriatry.txt, murders.txt**.
   
   ```
   # mkdir /share{,/cases}
   # touch /share/cases/{murders.txt,moriarty.txt}
   ```
   
   ![Результат вызова команды](/3/screenshots/task3_1.png)
   
   Создадим 2 группы пользователей: **bakerstreet, scotlandyard**.
   
   ```
   # groupadd bakerstreet
   # groupadd scotlandyard
   ```
   
   ![Результат вызова команды](/3/screenshots/task3_2.png)
   
   А также создадим 5 новых пользователей: **holmes, watson** в группе **bakerstreet** и **lestrade, gregson, jones** в группе **scotlandyard**.
   
   ```
   # useradd -g bakerstreet holmes
   # useradd -g bakerstreet watson
   
   # useradd -g scotlandyard lestrade
   # useradd -g scotlandyard gregson
   # useradd -g scotlandyard jones
   ```
   
   ![Результат вызова команды](/3/screenshots/task3_3.png)
   
   Для каждого нового пользователя установим пароль используя утилиту **passwd**:
   
   ```
   # passwd holmes
   # passwd jones
   ```
   
   ![Результат вызова команды](/3/screenshots/task3_4.png)
   
   Теперь установим нужные нам права доступа к директории **/share/cases/** и файлам в ней, используя Access Conrtol Lists (ACL).
   
   Первоначально имеем следущие права доступа:
   
   ![Результат вызова команды](/3/screenshots/task3_5.png)
   
   Владелец директории (*root*) имеет права на просмотр содержимого директории, добавление\удаление файлов. Пользователи не из группы *root* и все остальные пользователи могут имеют доступ к файлам директории (если на самих файл на стоит других запрещающих прав), но не могут добавлять\удалять файлы в ней, в том числе перезаписывать файлы.
   
   Для того, чтобы доступ к директории (на чтение и запись) имели только пользователи групп **bakerstreet** и **scotlandyadr**, установим следующие правила:
   
   ```
   # setfacl -m g::-,g:bakerstreet:rwx,g:scotlandyard:rwx /share/cases
   ```
  
  Не забудем установить ограничения для пользователя **jones** (только чтение):
  
  ```
  # setfacl -m u:jones:r /share/cases
  ```
  
  А также ограничим доступ в директории для всех остальных пользователей:
  
  ```
  # setfacl -m o::- /share/cases
  ```
  
  Установмим те же права доступа для файлов, которые уже находятся в директории **/share/cases/**:
  
  ```
  # setfacl -m g::-,g:bakerstreet:rw,g:scotlandyard:rw /share/cases/*
  # setfacl -m o::-,u:jones:r /share/cases/*
  ```
  
  А также установим правила default ACL, которые распространяются на создаваемые в директории **/share/cases/** файлы и директории:
  
  ```
  # setfacl -d -m g::-,g:bakerstreet:rwx,g:scotlandyard:rwx /share/cases
  # setfacl -d -m u:jones:r,o::- /share/cases
  ```
  
  В результате имеем следующие права доступа на саму директорию **/share/cases** и файлы в ней (пример с moriarty.txt):
  
  ![Результат вызова команды](/3/screenshots/task3_7.png)
  
  Создадим новый файл **/share/cases/new_file** и директорию **/share/cases/new_dir/** и проверим установленные (по умолчанию) на них права доступа:
  
  ![Результат вызова команды](/3/screenshots/task3_8.png)
  
  Как мы видим, у нового файла те же права доступа, что мы добавляли в default ACL, но с добавленным системным ограничением на исполнение новых созданных файлов. Исправить это может владелец файла, используя утилиту *chmod*. Права доступа на новую директорию перенесены без изменений.
  
  *Продемонстрируем эффектиность работы установленных прав*, проверив доступ к файлам от разных пользователей.
  
  Доступ для пользователя **holmes** и других пользователей группы **bakerstreet**: доступ к содержимому директории не ограничен, есть возможность добавлять, изменять и удалять файлы.
  
  ![Результат вызова команды](/3/screenshots/task3_9_Holmes.png)
  
  ![Результат вызова команды](/3/screenshots/task3_9_Watson.png)
  
  То же для пользователей из группы **scotlandyard**(демонстрация для пользователя **lestrade**).
  
  ![Результат вызова команды](/3/screenshots/task3_9_Lestrade.png)
  
  У пользователя **jones** прав уже меньше: нет возможности создавать, перезаписывать и удалять файлы, только их чтение.
  
  ![Результат вызова команды](/3/screenshots/task3_9_Jones.png)
  
  У пользователя **admin**, который не принадлежит ни одной из групп **bakerstreet, scotlandyard** доступа к директории **/share/cases/** нет.
  
  ![Результат вызова команды](/3/screenshots/task3_9_Admin.png)
